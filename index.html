<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finanzas Personales</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    
    <div class="sidebar-menu" id="sidebarMenu">
        <div class="sidebar-header">
            <div class="profile-info">
                <img src="https://via.placeholder.com/60" alt="Perfil" class="profile-img">
                <div class="user-details">
                    <span class="user-name">Cargando...</span>
                    <span class="user-phone"></span> 
                </div>
            </div>
            <button class="mode-toggle">☀️</button>
        </div>
        <nav class="sidebar-nav">
            <a href="#" onclick="showSection('accounts')"><i class="fas fa-wallet"></i> Cuentas</a>
            <a href="#" id="transactionsMenuBtn" onclick="showSection('transactions')"><i class="fas fa-exchange-alt"></i> Transacciones</a>
            <a href="#" onclick="showSection('types')"><i class="fas fa-tags"></i> Tipos de Mov.</a>
            <a href="#" onclick="showSection('charts')"><i class="fas fa-chart-line"></i> Gráficos</a>
            <a href="#" onclick="showSection('settings')"><i class="fas fa-cog"></i> Configuración</a>
        </nav>
    </div>
    <div class="menu-overlay" id="menuOverlay" onclick="closeSidebar()"></div>

    <div id="contentWrapper" class="content-wrapper">
        <header class="main-header">
            <button class="menu-toggle" id="menuToggle">☰</button>
            <h1 class="header-title">Finanzas</h1>
        </header>

        <main>
            <section id="accountsSection" class="section">
                <h2>Mis Cuentas</h2>
                <button class="btn-add" id="addAccountBtn">➕ Añadir Cuenta</button>
                <ul id="accountList">
                    </ul>
            </section>

            <section id="transactionsSection" class="section" style="display:none;">
                <h2>Transacciones</h2>
                <div class="filters">
                    <label>Cuenta:
                        <select id="accountFilterSelect"></select>
                    </label>
                    <label>Desde:
                        <input type="date" id="fromDate">
                    </label>
                    <label>Hasta:
                        <input type="date" id="toDate">
                    </label>
                </div>
                <p>Balance de la Cuenta Seleccionada: <span id="balance">$0.00</span></p>
                <button class="btn-add" id="addTransactionBtn">➕ Registrar Movimiento</button>
                <ul id="transactionList">
                    </ul>
            </section>

            <section id="typesSection" class="section" style="display:none;">
                <h2>Tipos de Movimiento</h2>
                <button class="btn-add" id="addTypeBtn">➕ Añadir Tipo</button>
                <ul id="typeList">
                    </ul>
            </section>

            <section id="chartsSection" class="section" style="display:none;">
                <h2>Análisis Gráfico</h2>
                <div class="filters">
                    <label>Cuenta para gráfico:
                        <select id="chartAccountSelect" onchange="loadChart()"></select>
                    </label>

                    <label>Desde: <input type="date" id="chartFrom" onchange="loadChart()"></label>
                    <label>Hasta: <input type="date" id="chartTo" onchange="loadChart()"></label>
                </div>
                <canvas id="balanceChart"></canvas>
            </section>

            <section id="settingsSection" class="section" style="display:none;">
                <h2>Configuración</h2>
                </section>
        </main>
    </div>


    <div id="modalAccount" class="modal">
        <div class="modal-content">
            <h3>Guardar Cuenta</h3>
            <input type="text" id="accountNameInput" placeholder="Nombre de la cuenta" required>
            <input type="text" id="accountDescInput" placeholder="Descripción (opcional)">
            <div style="display:flex; gap:10px;">
                <button id="saveAccountBtn">Guardar</button>
                <button class="modal-cancel" onclick="closeModal('modalAccount')">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="modalTransaction" class="modal">
        <div class="modal-content">
            <h3>Registrar Transacción</h3>
            <input type="number" id="transactionAmountInput" placeholder="Monto" step="0.01" required>
            <input type="text" id="transactionDescInput" placeholder="Detalle/Descripción">
            <select id="transactionTypeSelect"></select>
            <div style="display:flex; gap:10px;">
                <button id="saveTransactionBtn">Guardar</button>
                <button class="modal-cancel" onclick="closeModal('modalTransaction')">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="modalType" class="modal">
        <div class="modal-content">
            <h3>Guardar Tipo de Movimiento</h3>
            <input type="text" id="typeNameInput" placeholder="Nombre del Tipo (ej: Alquiler)" required>
            <label>Tipo:
                <select id="typeSignInput">
                    <option value="+">Entrada (+)</option>
                    <option value="-">Salida (-)</option>
                </select>
            </label>
            <div style="display:flex; gap:10px;">
                <button id="saveTypeBtn">Guardar</button>
                <button class="modal-cancel" onclick="closeModal('modalType')">Cancelar</button>
            </div>
        </div>
    </div>
    
    <div id="modalUser" class="modal">
        <div class="modal-content">
            <h3 id="userModalTitle">Crear Nuevo Usuario</h3>
            
            <input type="text" id="userNameInput" placeholder="Nombre de Usuario" required>
            
            <div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                <img id="userModalImgPreview" src="https://via.placeholder.com/60" alt="Foto de Perfil" class="profile-img" style="border: 2px solid #ccc; margin-bottom: 0;">
                <video id="userCameraFeed" style="width: 100%; max-height: 200px; display: none; border-radius: 8px;" autoplay></video>
                <canvas id="userCanvas" style="display: none;"></canvas>
            </div>

            <div style="display:flex; gap:10px; flex-wrap: wrap;">
                <button id="openCameraBtn" class="btn-add" style="flex: 1;"><i class="fas fa-camera"></i> Abrir Cámara</button>
                <button id="capturePhotoBtn" class="btn-add" style="flex: 1; display: none;"><i class="fas fa-video"></i> Capturar</button>
                
                <input type="file" id="userPhotoFileInput" accept="image/*" style="display: none;">
                <button id="uploadFileBtn" class="btn-add" style="flex: 1;"><i class="fas fa-upload"></i> Subir Foto</button>
            </div>

            <div style="display:flex; gap:10px;">
                <button id="saveUserBtn">Guardar Usuario</button>
                <button class="modal-cancel" onclick="closeModal('modalUser')">Cancelar</button>
            </div>
        </div>
    </div>
    
    <script src="js/app.js"></script>
    <script src="js/charts.js"></script>

    <script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js")
  .then(()=>console.log("Service Worker registrado"))
  .catch(err=>console.log("Error:",err));
}
</script>
</body>
</html>